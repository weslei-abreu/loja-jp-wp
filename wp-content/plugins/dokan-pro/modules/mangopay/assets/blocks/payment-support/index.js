(()=>{"use strict";var e,a={6878:(e,a,t)=>{const n=window.wp.i18n,d="dokan_mangopay",r=window.wp.htmlEntities,s=window.wp.element,o=window.ReactJSXRuntime,i=function(e){let a="object"==typeof e?.cards?e.cards:{};const[t,d]=(0,s.useState)(""),[r,i]=(0,s.useState)([]),[c,l]=(0,s.useState)([]);return(0,s.useEffect)((()=>{if(Object.keys(a).length){let t=Object.keys(a).map((e=>({key:e,value:a[e]}))),n=t.filter((a=>e.validateItem(a)));d(n.length?n[0].key:""),l(n),i(t)}}),[]),(0,s.useEffect)((()=>{e.onChange(t)}),[t]),(0,o.jsx)("div",{className:"dokan-mangopay-credit-cards",children:Object.keys(a).length?(()=>{let a=[];return r.forEach((t=>{e.validateItem(t)&&a.push((0,o.jsx)("option",{value:t.key,children:t.value},t.key))})),a.length||a.push((0,o.jsx)("option",{value:"",children:(0,n.__)("Select a card","dokan")},"no_card_found")),(0,o.jsx)("select",{className:"dokan-mangopay-credit-cards-content",name:"dokan_mangopay_card_type",value:t,onChange:e=>d(e.target.value),children:a})})():(0,n.__)("No cards found","dokan")})},c=window.wp.apiFetch;var l=t.n(c);const{Label:g,ValidatedTextInput:u,Button:p,Spinner:_}=window.wc.blocksComponents,m=e=>{var a,t;const r=window.wc.wcSettings.getSetting(`${d}_data`),c=window.mangoPay,[_,m]=(0,s.useState)(""),[y,h]=(0,s.useState)(""),[v,k]=(0,s.useState)(""),[b,x]=(0,s.useState)(""),[w,f]=(0,s.useState)(""),[j,C]=(0,s.useState)([]),[S,R]=(0,s.useState)([]),[N,I]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{var e,a;let t;t=Object.keys(null!==(e=r?.months)&&void 0!==e?e:{}).map((e=>({value:e,label:r?.months[e]}))),t[0]&&f(t[0].value),R(t),t=Object.keys(null!==(a=r?.years)&&void 0!==a?a:{}).map((e=>({value:e,label:r?.years[e]}))),t[0]&&x(t[0].value),C(t)}),[]),(0,o.jsxs)("div",{className:"dokan-mangopay-add-card-box",children:[(0,o.jsx)(g,{label:(0,n.__)("Card Type","dokan")}),(0,o.jsx)(i,{id:"choose-card-type",cards:null!==(a=r?.available_card_types)&&void 0!==a?a:{},selectedCards:null!==(t=r?.selected_debit_cards)&&void 0!==t?t:{},validateItem:e=>"BANK_WIRE"!==e.key&&"IDEAL"!==e.key&&r?.selected_credit_cards.includes(e.key),onChange:e=>m(e)}),(0,o.jsx)(u,{id:"dokan-register-card-number",errorId:"dokan-register-card-number",className:"",label:(0,n.__)("Card Number","dokan"),type:"text",value:y,onChange:e=>{h(e)},focusOnMount:!1,validateOnMount:!1}),(0,o.jsx)(u,{id:"dokan-register-card-cvv",errorId:"dokan-register-card-cvv",className:"",label:(0,n.__)("CVV","dokan"),type:"text",value:v,onChange:e=>{k(e)},focusOnMount:!1,validateOnMount:!1}),(0,o.jsx)("div",{className:"dokan-mangopay-add-card-box-divider"}),(0,o.jsx)(g,{label:(0,n.__)("Expiration Date","dokan")}),(0,o.jsxs)("div",{className:"dokan-mangopay-expire-select",children:[(0,o.jsx)("select",{className:"dokan-mangopay-expire-month",value:w,onChange:e=>f(e.target.value),children:S.map((e=>(0,o.jsx)("option",{value:e.value,children:e.label},e.value)))}),(0,o.jsx)("span",{children:"/"}),(0,o.jsx)("select",{className:"dokan-mangopay-expire-year",value:b,onChange:e=>x(e.target.value),children:j.map((e=>(0,o.jsx)("option",{value:e.value,children:e.label},e.value)))})]}),(0,o.jsx)("div",{className:"dokan-mangopay-add-card-box-divider"}),(0,o.jsxs)("div",{className:"dokan-mangopay-add-card-box-button",children:[(0,o.jsx)(p,{disabled:N,onClick:()=>{if(void 0===r?.userId||""===r?.userId||!r?.userId)return;const a={user_id:r?.userId,card_type:_};let t=w;1==String(w).length&&(t=`0${String(w)}`);const n=`${t}${String(b)}`,d={cardNumber:String(y),cardExpirationDate:n,cardCvx:String(v),cardType:_};_&&w&&b&&d.cardNumber&&d.cardCvx&&(I(!0),l()({data:a,path:"/dokan/v1/mangopay/block/registered/cards",method:"POST"}).then((a=>{if(a?.CardRegistrationId){const{CardRegistrationId:t,CardRegistrationURL:n,PreregistrationData:s,AccessKey:o}=a;((a,t,n,d,s)=>{c.cardRegistration.baseURL=r.mangopay_url,c.cardRegistration.clientId=r.client_id,c.cardRegistration.init({cardRegistrationURL:t,preregistrationData:n,accessKey:d,Id:a}),c.cardRegistration.registerCard(s,(function(a){a.cardRegId&&a.cardRegData?((a,t)=>{const n={card_id:a,reg_data:t};l()({data:n,path:"/dokan/v1/mangopay/block/registered/cards",method:"PUT"}).finally((()=>{I(!1),e.refreshCards()}))})(a.cardRegId,a.cardRegData):(I(!1),e.refreshCards())}),(function(a){console.error(a),I(!1),e.refreshCards()}))})(t,n,s,o,d)}})).catch((e=>{I(!1)})))},children:N?(0,o.jsx)("span",{children:(0,n.__)("Registering…","dokan")}):(0,o.jsx)("span",{children:(0,n.__)("Register","dokan")})}),(0,o.jsx)(p,{disabled:N,onClick:()=>e.onClose(),children:(0,n.__)("Cancel","dokan")})]})]})},y=e=>{let a=e?.cards,t=e?.selected,d=e?.setSelectedCard;const{RadioControl:r,Button:i}=window.wc.blocksComponents,[c,l]=(0,s.useState)([]),[g,u]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{if(Array.isArray(a)&&a.length){let t=a.map((a=>({label:(0,o.jsxs)(o.Fragment,{children:[a.Alias," ",(0,o.jsx)("div",{className:"dashicons dashicons-trash",onClick:()=>e.deleteCard(a.Id)})]}),value:a.Id})));l(t)}}),[]),(0,o.jsxs)("div",{className:"dokan-mangopay-registered-cards-box",children:[Array.isArray(a)&&a.length?(0,o.jsx)(r,{className:"",onChange:e=>{d(e)},disabled:!1,selected:t,options:c}):(0,o.jsx)("div",{className:"dokan-mangopay-registered-cards-box-empty",children:(0,o.jsx)("p",{className:"dokan-mangopay-registered-cards-box-empty-message",children:(0,n.__)("You have not registered a card yet. You can add one below.","dokan")})}),(0,o.jsx)("div",{className:"dokan-mangopay-add-new-box",children:g?(0,o.jsx)(m,{refreshCards:()=>e.refreshCards(),onClose:()=>u(!1)}):(0,o.jsx)(i,{onClick:()=>u(!g),children:(0,n.__)("+ Add New","dokan")})})]})},{Spinner:h}=window.wc.blocksComponents,v=()=>(0,o.jsxs)("div",{className:"dokan-mangopay-registered-cards-loader",children:[(0,o.jsx)(h,{}),(0,o.jsx)("span",{className:"dokan-mangopay-registered-cards-loader-label",children:(0,n.__)("Processing...","dokan")})]}),k=function(e){const[a,t]=(0,s.useState)(!0),[n,d]=(0,s.useState)([]),[r,i]=(0,s.useState)(""),c=async()=>{t(!0);try{const e=await l()({path:"/dokan/v1/mangopay/block/registered/cards"});if("object"==typeof e&&Object.values(e).length){let a=Object.values(e);d(a),g(a[a.length-1].Id)}else d([]),g("")}catch(e){console.error("Error fetching registered cards:",e)}finally{t(!1)}},g=a=>{i(a),e.onChange(a)};return(0,s.useEffect)((()=>{c()}),[]),(0,o.jsx)("div",{className:"mangopay-registered-cards",children:a?(0,o.jsx)(v,{}):(0,o.jsx)(y,{deleteCard:e=>(e=>{t(!0),l()({path:"/dokan/v1/mangopay/block/registered/cards",method:"DELETE",data:{card_id:e}}).finally((()=>{c()}))})(e),refreshCards:()=>c(),cards:n,selected:r,setSelectedCard:g})})},b=window.wc.blocksComponents.RadioControlAccordion,x=function(e){var a;const[t,d]=(0,s.useState)(""),[r,c]=(0,s.useState)([]),[l,g]=(0,s.useState)(""),[u,p]=(0,s.useState)(""),[_,m]=(0,s.useState)(""),[y,h]=(0,s.useState)(""),[v,x]=(0,s.useState)(""),[w,f]=(0,s.useState)(""),[j,C]=(0,s.useState)(""),[S,R]=(0,s.useState)(""),[N,I]=(0,s.useState)(""),E=null!==(a=e?.settings)&&void 0!==a?a:{},{eventRegistration:O,emitResponse:A}=e,{onPaymentSetup:P,onPaymentProcessing:D}=O,T=e=>{"bank_wire"===e&&I("")},M=e=>"BANK_WIRE"!==e.key&&E?.selected_credit_cards.includes(e.key),B=e=>E?.selected_debit_cards.includes(e.key),L=e=>{I(e)};(0,s.useEffect)((()=>{g("yes"),p(window.navigator.language),m(window.screen.colorDepth),h(window.screen.height),x(window.screen.width),f((new Date).getTimezoneOffset().toString()),C(window.navigator.userAgent),R(window.navigator.javaEnabled()?"yes":"no"),(()=>{let e="";const a=[...r],t=Array.isArray(E?.selected_credit_cards)?E.selected_credit_cards:[];if(E?.credit_card_activated&&E?.credit_card_enabled){var s,l;const t="card",d={value:t,label:E?.credit_card_enabled?(0,n.__)("Credit Card","dokan"):(0,n.__)("Credit Card Type","dokan"),onChange:T,name:"dokan_mangopay_payment_type_credit_card",content:(0,o.jsx)(i,{cards:null!==(s=E?.available_card_types)&&void 0!==s?s:{},selectedCards:null!==(l=E?.selected_credit_cards)&&void 0!==l?l:{},validateItem:M,onChange:L})};e=String(e).length?e:t,a.push(d)}if(E?.debit_card_enabled&&(E?.credit_card_enabled||t.includes("BANK_WIRE"))){var g,u;const d="directdebitweb",r={value:d,label:E?.credit_card_enabled||t.includes("BANK_WIRE")?(0,n.__)("Direct Debit Web Wire","dokan"):(0,n.__)("Payment Type","dokan"),onChange:T,name:"dokan_mangopay_payment_type_debit_card",content:(0,o.jsx)(i,{cards:null!==(g=E?.available_direct_payments)&&void 0!==g?g:{},selectedCards:null!==(u=E?.selected_debit_cards)&&void 0!==u?u:{},validateItem:B,onChange:L})};e=String(e).length?e:d,a.push(r)}if(t.includes("BANK_WIRE")&&(E?.credit_card_activated||E?.debit_card_enabled)){const t="bank_wire",d={value:t,label:(0,n.__)("Direct Bank Wire","dokan"),onChange:T,name:"dokan_mangopay_payment_type_bank_wire",content:(0,o.jsx)(o.Fragment,{})};e=String(e).length?e:t,a.push(d)}if(E?.saved_cards_enabled&&E?.mangopay_account_id&&String(E.mangopay_account_id).length){const t="registeredcard",d={value:t,label:(0,n.__)("Registered Card","dokan"),onChange:T,name:"dokan_mangopay_payment_type_registeredcard",content:(0,o.jsx)(k,{onChange:L})};e=String(e).length?e:t,a.push(d)}d(e),c(a)})()}),[]);const W=()=>{const e={dokan_mangopay_payment_type:t,"dokan-mangopay-3ds2-java":String(S),"dokan-mangopay-3ds2-js":String(l),"dokan-mangopay-3ds2-lang":String(u),"dokan-mangopay-3ds2-color-depth":String(_),"dokan-mangopay-3ds2-screen-height":String(y),"dokan-mangopay-3ds2-screen-width":String(v),"dokan-mangopay-3ds2-timezone-offset":String(w),"dokan-mangopay-3ds2-user-agent":String(j)};let a="";return"card"===t?e.dokan_mangopay_card_type=N:"directdebitweb"===t?e.dokan_mangopay_directdebitweb_type=N:"registeredcard"===t&&(e.registered_card_selected=N,N||(a=(0,n.__)("Could not create the MangoPay payment. Please select a registered card or add one.","dokan"))),a?{type:A.responseTypes.ERROR,message:a}:{type:A.responseTypes.SUCCESS,meta:{paymentMethodData:e}}};return(0,s.useEffect)((()=>{const e=P(W);return()=>e()}),[t,N]),(0,o.jsx)("div",{className:"mangopay-block-description",children:(0,o.jsx)(b,{instanceId:Date.now(),className:"mangopay-radio-block",id:"dokan_mangopay_payment_type",onChange:e=>{d(e)},options:r,selected:t})})},w=function(e){var a,t;const{PaymentMethodLabel:n}=e.components,d=null!==(a=e?.settings)&&void 0!==a?a:{};let r=d?.icon?(0,o.jsx)("img",{src:d.icon}):null!==(t=e.label)&&void 0!==t?t:"";return(0,o.jsx)(n,{text:r})};var f;const{registerPaymentMethod:j}=window.wc.wcBlocksRegistry,C=wc.wcSettings.getSetting(`${d}_data`),S=null!==(f=C?.title)&&void 0!==f?f:(0,r.decodeEntities)((0,n.__)("MangoPay","dokan"));j({name:d,label:(0,o.jsx)(w,{label:S,settings:C}),content:(0,o.jsx)(x,{settings:C}),edit:(0,o.jsx)(x,{settings:C}),canMakePayment:()=>!0,ariaLabel:S,supports:{}})}},t={};function n(e){var d=t[e];if(void 0!==d)return d.exports;var r=t[e]={exports:{}};return a[e](r,r.exports,n),r.exports}n.m=a,e=[],n.O=(a,t,d,r)=>{if(!t){var s=1/0;for(l=0;l<e.length;l++){for(var[t,d,r]=e[l],o=!0,i=0;i<t.length;i++)(!1&r||s>=r)&&Object.keys(n.O).every((e=>n.O[e](t[i])))?t.splice(i--,1):(o=!1,r<s&&(s=r));if(o){e.splice(l--,1);var c=d();void 0!==c&&(a=c)}}return a}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[t,d,r]},n.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return n.d(a,{a}),a},n.d=(e,a)=>{for(var t in a)n.o(a,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},n.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={8190:0,2034:0};n.O.j=a=>0===e[a];var a=(a,t)=>{var d,r,[s,o,i]=t,c=0;if(s.some((a=>0!==e[a]))){for(d in o)n.o(o,d)&&(n.m[d]=o[d]);if(i)var l=i(n)}for(a&&a(t);c<s.length;c++)r=s[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(l)},t=globalThis.webpackChunkdokan_pro=globalThis.webpackChunkdokan_pro||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))})();var d=n.O(void 0,[2034],(()=>n(6878)));d=n.O(d)})();