(()=>{var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var t=jQuery,o=function(){};o.prototype.setDefaultValues=function(){this.model=new Ai1wm.Import,this.stopUpload=!1},o.prototype.init=function(){var e=this,o=t("#ai1wm-import-form"),r=t("#ai1wm-import-file"),i=t("#ai1wm-drag-drop-area");r.on("change",(function(t){e.setDefaultValues();var r=t.target.files.item(0);r&&(e.fileSize=r.size,e.model.checkDiskSpace(e.fileSize,(function(){try{e.onFilesAdded(r),e.onBeforeUpload(r),e.upload(r)}catch(t){e.onError(t)}}))),o.trigger("reset"),t.preventDefault()})),i.on("dragenter",(function(e){i.addClass("ai1wm-drag-over"),e.preventDefault()})),i.on("dragover",(function(e){i.addClass("ai1wm-drag-over"),e.preventDefault()})),i.on("dragleave",(function(e){i.removeClass("ai1wm-drag-over"),e.preventDefault()})),i.on("drop",(function(t){e.setDefaultValues(),i.removeClass("ai1wm-drag-over");var r=t.originalEvent.dataTransfer.files.item(0);r&&(e.fileSize=r.size,e.model.checkDiskSpace(e.fileSize,(function(){try{e.onFilesAdded(r),e.onBeforeUpload(r),e.upload(r)}catch(t){e.onError(t)}}))),o.trigger("reset"),t.preventDefault()}))},o.prototype.upload=function(e,t){var o=this;t=t||0;var r=e.size>ai1wmve_uploader.chunk_size?ai1wmve_uploader.chunk_size:e.size,i=this.getFormData(e,r);fetch(ai1wmve_uploader.url,{method:"POST",credentials:"include",body:i}).then((function(t){if(!o.stopUpload)switch(t.status){case 413:return ai1wmve_uploader.chunk_size=r/2,o.upload(e);case 200:return t.text().then((function(t){var i=Ai1wm.Util.json(t);if(i&&0===JSON.parse(i).errors.length){e=e.slice(r,e.size,"application/octet-binary");var a=(o.fileSize-e.size)/o.fileSize*100;return o.onUploadProgress(a.toFixed(2)),100===a?o.onFileUploaded():o.upload(e)}throw new Error(t)}));default:throw new Error(t.status)}})).catch((function(){var r=1e3*t;if(t>=30)return o.onError(new Error(ai1wm_locale.problem_while_uploading_your_file));t++,setTimeout(o.upload.bind(o,e,t),r)}))},o.prototype.getFormData=function(e,t){var o=ai1wmve_uploader.params,r=new FormData;for(var i in r.append("upload-file",e.slice(0,t,"application/octet-binary")),o)r.append(i,o[i]);return r},o.prototype.c1=function(e){if(!ai1wmve_uploader.filters.ai1wm_archive_extension.some((function(t){return e.name.substr(-t.length)===t})))throw new Error(ai1wm_locale.invalid_archive_extension)},o.prototype.c3=function(){if(ai1wm_compatibility.messages.length>0)throw new Error(ai1wm_compatibility.messages.join())},o.prototype.onFilesAdded=function(e){this.c1(e),this.c3(e),t(window).bind("beforeunload",(function(){return ai1wm_locale.stop_importing_your_website}))},o.prototype.onBeforeUpload=function(e){var o=this,r=Ai1wm.Util.random(12),i=Ai1wm.Util.form("#ai1wm-import-form").concat({name:"storage",value:r}).concat({name:"archive",value:e.name}).concat({name:"file",value:1});this.model.setParams(i),t.extend(ai1wmve_uploader.params,{storage:r,archive:e.name}),this.model.onStop=function(){o.stopUpload=!0,o.model.clean()},this.model.setStatus({type:"progress",percent:"0.00"})},o.prototype.onUploadProgress=function(e){this.model.setStatus({type:"progress",percent:e})},o.prototype.onFileUploaded=function(){this.model.start()},o.prototype.onError=function(e){this.model.setStatus({type:"error",title:ai1wm_locale.unable_to_import,message:e.message})},e.g.Ai1wm=jQuery.extend({},e.g.Ai1wm,{UnlimitedExtensionUploader:o})})();